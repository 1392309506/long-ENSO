# 训练数据说明文档

本说明基于当前代码与配置（例如 [model_config.json](model_config.json)、[dataset/godas.py](dataset/godas.py)、[zaxis.txt](zaxis.txt)），用于明确各训练阶段输入变量、数据来源与数据形态。若你的实际数据范围/分辨率与默认配置不同，请在本文件相应位置更新。

## 通用网格与坐标

- 空间范围（默认配置）
  - 纬度：-63.5 到 63.5（共 128 点）
  - 经度：0.5 到 359.5（共 360 点）
  - 对应网格大小：128 x 360
- 水平分辨率：约 1 度（由 128 点覆盖 127 度纬向、360 点覆盖 360 度经向推算）
- 垂向层数：16 层，深度为 `10,15,30,50,75,100,125,150,200,250,300,400,500,600,800,1000` 米
  - 见 [zaxis.txt](zaxis.txt)
- 时间分辨率：月度（文件名为 `YYYY_M`）
- 实际时段范围：由 `data_dir` 内现有文件名决定（示例：1980_1 ~ 1987_12）

## 变量定义

- 海洋变量（训练主干使用）：
  - 多层（16 层）：`so`, `thetao`, `uo`, `vo`
  - 单层（表层）：`tos`, `zos`
- 大气变量（阶段二或外部扰动使用）：
  - 单层：`tauu`, `tauv`

## 阶段一：深海子模型训练（Stage-1）

**目的**：仅基于海洋变量训练 Encoder-Fusion-Decoder，学习平滑的长期演化趋势。

### 数据来源
- 训练脚本：[train_stage1.py](train_stage1.py)
- 数据集类：`GODAS`（见 [dataset/godas.py](dataset/godas.py)）
- 训练数据目录：`data_dir`（由 `--data_dir` 指定）

### 输入变量与拼接方式
- `input_var_list` 控制海洋变量（Stage-1 建议为 `so thetao uo vo`）
- Stage-1 会自动移除 `tos/zos`（海表变量），`tauu/tauv` 也会被自动移除
- 通道拼接规则（按变量顺序拼接）：
  - 多层变量每个变量提供 16 通道
  - 单层变量每个变量提供 1 通道
- 以 Stage-1 的 4 个次表层变量为例：
  - 通道数 = 16*4 = 64

### 输入/标签张量形状（以 `input_steps=1, predict_steps=1` 为例）
- `ocean_vars`：`(C, H, W)`，其中 `C=66, H=128, W=360`
- `labels`：`(C, H, W)`
- 若 `predict_steps > 1`，`labels` 形状为 `(T, C, H, W)`

> 说明：模型内部按 `in_chans=[16,16,1,16,16,1]` 将通道切分给不同变量编码器，顺序与 `input_var_list` 一致。

### 大气变量
- 当前数据加载逻辑仍会读取 `atmo_vars`（`tauu/tauv`），但 Stage-1 模型不使用它
- 若未来你希望完全去掉大气读取，可在数据集类中关闭该分支

## 阶段二：扰动/扩散模块训练（Stage-2）

**说明**：当前阶段暂不启用，仅给出数据接口预期。

### 条件输入
- 条件由两部分拼接：
  1) Stage-1 基础预测 `base_step`（海洋变量）
  2) `atmo_vars`（如 `tauu, tauv`）
- 条件通道数应与 `config.atmo_dims` 对齐

### 形状约束（示例）
- `base_step`：`(C, H, W)`，`C=66`
- `atmo_vars`：`(C_atmo, H, W)`，默认 `C_atmo=2`（`tauu/tauv`, `input_steps=1`）

## 数据预处理与插值要求

- 数据需插值到上述网格范围与分辨率，并与 `stat/` 中均值方差一致
- 参考 [README.md](README.md) 中的插值流程和示例数据说明

## 待填信息（请按你的真实数据补齐）

- GODAS 训练数据具体时段：________
- 是否使用验证集/测试集（SODA/ORAS5 等）：________
- 是否对输入做归一化/标准化以及具体方法：________
